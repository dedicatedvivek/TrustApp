Libra.TrendChart=function(){var _container=null,_parent=null,_width=600,_height=400,_marginTop=8,_marginBottom=10,_marginLeft=20,_marginRight=20,_xMinValue=1900,_xMaxValue=2010,_yMinValue=0,_yMaxValue=1000,_gridWidth=0,_gridHeight=0,_gridLeft=0,_gridRight=0,_gridTop=0,_gridBottom=0,_textWidthLong=45,_textWidth=35,_textHeight=20,_footerHeight=30,_ovalSize=7,_ovalHoverSize=12,_strokeweight=2,_data=null,_datas=null,MaxIndex=2,_containers={},_groups={},ZIndex=1010;this.SetTextPosition=function(a){DefaultLineText=a};this.Init=function(parent,width,height,dataString){_parent=parent;_width=width;_height=height;try{eval("_datas = "+dataString)}catch(a){}Libra.Draw2D.Initialize();this.Render(0)};this.Render=function(a){S_vGroup=null;for(var b=0;b<MaxIndex;b++)$(_containers[b]).hide();if(_containers[a]){$(_containers[a]).show();return}if(_datas){LineTextLeft=DefaultLineText;_data=_datas[a];_container=Libra.Draw2D.Canvas(_parent,_width,_height);this.InitialParam();if(_xMaxValue==_xMinValue||_xMinValue==_yMaxValue)alert("invalid trend data");this.DrawCanvas();this.DrawTrend(a);_containers[a]=_container}};this.DrawTrend=function(c){if(!_data)return;var b=Libra.Draw2D.Group(_container,_width,_height);Libra.Draw2D.SetPosition(b,0,_gridTop+_marginTop);for(var a=0;a<_data.m_Lines.length;a++)this.DrawTrendLine(b,_data.m_Lines[a],_data.m_Lines[a].m_config.m_name);_groups[c]=b};this.InitialParam=function(){_gridTop=_marginTop=_data._config.m_marginTop;_marginBottom=_data._config.m_marginBottom;_gridLeft=_marginLeft=_data._config.m_marginLeft;_marginRight=_data._config.m_marginRight;_xMinValue=_data._config.m_xminValue;_xMaxValue=_data._config.m_xmaxValue;_yMinValue=_data._config.m_yminValue;_yMaxValue=_data._config.m_ymaxValue;_gridWidth=_width-_marginLeft-_marginRight;_gridHeight=_height-_marginTop-_marginBottom-_footerHeight;_gridRight=_gridLeft+_gridWidth;_gridBottom=_gridTop+_gridHeight};this.DrawCanvas=function(){this.SetVerticalCorrd();this.SetHorizontalCoord()};this.SetVerticalCorrd=function(){for(var d=0;d<_data._grid.m_vLine.length;d++){var a=_data._grid.m_vLine[d],b=this.xValueToPos(a.m_value),e=Libra.Draw2D.Line(_container,b,_gridTop,b,_gridBottom,a.color?a.color:"#cccccc");if(a.color&&a.color!="#cccccc")Libra.Draw2D.Line(_container,b+1,_gridTop,b+1,_gridBottom,a.color?a.color:"#cccccc");var c=Libra.Draw2D.Text(_container,_textWidth,_textHeight,a.m_text,"#000");$(c).css("text-align","center");Libra.Draw2D.SetPosition(c,b-_textWidth/2,_gridBottom+5);Libra.Draw2D.SetColor(c,$(_container).parent().css("background-color"))}};this.SetHorizontalCoord=function(){for(var d=0;d<_data._grid.m_hLine.length;d++){var a=_data._grid.m_hLine[d],c=this.yValueToPos(a.m_value)+_gridTop+_marginTop,e=Libra.Draw2D.Line(_container,_gridLeft,c,_gridRight,c,a.color?a.color:"#cccccc");if(a.m_text){var b=Libra.Draw2D.Text(_container,_textWidthLong-10,_textHeight,a.m_text,"#000");$(b).css("text-align","right");Libra.Draw2D.SetColor(b,$(_container).parent().css("background-color"));Libra.Draw2D.SetPosition(b,_gridLeft-_textWidthLong,c-_textHeight/2)}if(a.m_text2){var b=Libra.Draw2D.Text(_container,_textWidth-10,_textHeight,a.m_text2,"#000");$(b).css("text-align","left");Libra.Draw2D.SetPosition(b,_gridRight+4,c-_textHeight/2);Libra.Draw2D.SetColor(b,$(_container).parent().css("background-color"))}}};var DefaultLineText=10,LineTextLeft=DefaultLineText,renderTime=300,textLength=65;this.DrawTrendLine=function(p,d,o){var j=Libra.Draw2D.Group(p,_width,_height),m=d,h=m.m_config.m_color,n=m.m_config.m_name;textLength=n.length*7;var k=Libra.Draw2D.Text(_container,textLength,_textHeight,n,h);$(k).css("text-align","center");Libra.Draw2D.SetPosition(k,LineTextLeft,_gridBottom+_footerHeight);Libra.Draw2D.SetColor(k,$(_container).parent().css("background-color"));LineTextLeft+=textLength;var i=this.xValueToPos(_xMinValue)+","+this.yValueToPos(_yMinValue)+" ";renderTimeSpan=renderTime/d.m_pointList.length;for(var e=0;e<d.m_pointList.length;e++){var c=d.m_pointList[e],f=this.xValueToPos(c.m_x),g=this.yValueToPos(c.m_y);i+=parseInt(f)+","+parseInt(g)+" "}var l=Libra.Draw2D.PolyLine(j,i,h,_gridWidth,_gridHeight);l.strokeweight=_strokeweight;$(l).css("z-index",0);for(var e=0;e<d.m_pointList.length;e++){var c=d.m_pointList[e],f=this.xValueToPos(c.m_x),g=this.yValueToPos(c.m_y);if(c.m_Visible==true){var a=Libra.Draw2D.Oval(j,_ovalSize,_ovalSize);Libra.Draw2D.SetPosition(a,f-_ovalSize/2,g-_ovalSize/2);$(a).css("z-index",10);a.xx=f;a.yy=g;a.year=c.m_x;Libra.Draw2D.SetColor(a,h);Libra.Draw2D.SetTitle(a,c.m_text);var b=Libra.Draw2D.Oval(j,_ovalSize*3,_ovalSize*3);$(b).css("z-index",100);$(b).css("opacity",0);Libra.Draw2D.SetPosition(b,f-_ovalSize*1.5,g-_ovalSize*1.5);Libra.Draw2D.SetColor(b,h);Libra.Draw2D.SetTitle(b,c.m_text);$(b).mouseover(function(){var b=$(this).prev()[0];Libra.Draw2D.SetWidthHeight(b,_ovalHoverSize,_ovalHoverSize);Libra.Draw2D.SetPosition(b,b.xx-_ovalHoverSize/2,b.yy-_ovalHoverSize/2);var e=b.fillcolor,a=$(this).parent(),c=a.parent();if(!VML){a.detach();a.appendTo(c);if(IE)$(this).parent().parent().children().children().not(this).mouseout()}else{a[0].style.zIndex=ZIndex;a.css("z-index",ZIndex);ZIndex=ZIndex+1;var d=c.children().not(a).detach();d.appendTo(c);d.each(function(){var c=$(this).children("polyline").first()[0].data,b=$(this).children("polyline").first()[0].color;$(this).children("polyline").first().remove();var a=Libra.Draw2D.PolyLine(this,c,b,_gridWidth,_gridHeight);a.strokeweight=_strokeweight;$(a).css("z-index",0)})}});$(b).mouseout(function(){var a=$(this).prev()[0];Libra.Draw2D.SetWidthHeight(a,_ovalSize,_ovalSize);Libra.Draw2D.SetPosition(a,a.xx-_ovalSize/2,a.yy-_ovalSize/2)});$(b).mouseup(function(){var a=$(this).prev()[0];try{ShowListByYear(a.year,o)}catch(b){}});$(a).mouseover(function(){var b=this;Libra.Draw2D.SetWidthHeight(b,_ovalHoverSize,_ovalHoverSize);Libra.Draw2D.SetPosition(b,b.xx-_ovalHoverSize/2,b.yy-_ovalHoverSize/2);var e=b.fillcolor,a=$(this).parent(),c=a.parent();if(!VML){a.detach();a.appendTo(c);if(IE)$(this).parent().parent().children().children().not(this).mouseout()}else{a[0].style.zIndex=ZIndex;a.css("z-index",ZIndex);ZIndex=ZIndex+1;var d=c.children().not(a).detach();d.appendTo(c);d.each(function(){var c=$(this).children("polyline").first()[0].data,b=$(this).children("polyline").first()[0].color;$(this).children("polyline").first().remove();var a=Libra.Draw2D.PolyLine(this,c,b,_gridWidth,_gridHeight);a.strokeweight=_strokeweight;$(a).css("z-index",0)})}});$(a).mouseout(function(){var a=this;Libra.Draw2D.SetWidthHeight(a,_ovalSize,_ovalSize);Libra.Draw2D.SetPosition(a,a.xx-_ovalSize/2,a.yy-_ovalSize/2)});$(a).mouseup(function(){var a=this;ShowListByYear(a.year,o)})}i+=parseInt(f)+","+parseInt(g)+" "}};this.xValueToPos=function(a){return _gridLeft+_gridWidth*(a-_xMinValue)/(_xMaxValue-_xMinValue)};this.yValueToPos=function(a){return _gridHeight-(_gridTop+_gridHeight*(a-_yMinValue)/(_yMaxValue-_yMinValue))};this.ShowOvals=function(a){S_vGroup=a;ShowEachYearPoints(_xMinValue,_xMaxValue)}};var VML=true;if(document.all){var ua=navigator.userAgent,re=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(re.exec(ua)!=null)rv=parseFloat(RegExp.$1)}else VML=false;var IE=true;if(document.all)IE=true;else IE=false;Libra.Draw2D.Initialize=function(){if(VML)Libra.Draw2D.Vml.Initialize();else Libra.Draw2D.Svg.Initialize()};Libra.Draw2D.Group=function(b,d,c){if(VML){var a=Libra.Draw2D.Vml.Group(b,d,c);$(a).css("position","relative");return a}else{var a=Libra.Draw2D.Svg.Group(b,d,c);$(a).css("position","relative");return a}};Libra.Draw2D.Canvas=function(b,d,c){if(VML){Libra.Draw2D.Vml.Initialize();var a=Libra.Draw2D.Vml.Group(b,d,c);$(a).css("position","relative");return a}else{Libra.Draw2D.Svg.Initialize();var a=Libra.Draw2D.Svg.Canvas(b,d,c);return a}};Libra.Draw2D.Rect=function(a,c,b){if(VML)return Libra.Draw2D.Vml.Rect(a,c,b);else return Libra.Draw2D.Svg.Rect(a,c,b)};Libra.Draw2D.Text=function(b,e,c,f,d){if(VML){var a=Libra.Draw2D.Vml.Text(b,e,c,f);$(a).css("color",d);return a}else{var a=Libra.Draw2D.Svg.Text(b,e,c,f);a.setAttribute("fill",d);return a}};Libra.Draw2D.Oval=function(a,c,b){if(VML)return Libra.Draw2D.Vml.Oval(a,c,b);else return Libra.Draw2D.Svg.Oval(a,c,b)};Libra.Draw2D.Line=function(b,c,d,e,f,a){if(VML)return Libra.Draw2D.Vml.Line(b,c,d,e,f,a);else return Libra.Draw2D.Svg.Line(b,c,d,e,f,a)};Libra.Draw2D.PolyLine=function(a,c,d,e,b){if(VML)return Libra.Draw2D.Vml.PolyLine(a,c,d,e,b);else return Libra.Draw2D.Svg.PolyLine(a,c,d,e,b)};Libra.Draw2D.SetPosition=function(a,b,c){if(VML){$(a).css("left",b);$(a).css("top",c)}else if(a.tagName=="g")a.setAttribute("transform","translate("+b+", "+c+")");else if(a.tagName=="ellipse"){a.setAttribute("cx",b+a.getAttribute("rx")/1.2);a.setAttribute("cy",c+a.getAttribute("ry")/1.2)}else if(a.tagName=="text"){var e;try{e=a.getComputedTextLength()}catch(f){e=100}var d=0;if($(a).css("text-align")=="right")d=a.width-e;else if($(a).css("text-align")=="center")d=(a.width-e)/2;a.setAttribute("x",b+(d>0?d:0));a.setAttribute("y",c+12)}else{a.setAttribute("x",b);a.setAttribute("y",c)}};Libra.Draw2D.SetColor=function(a,b){if(VML)a.fillcolor=a.strokecolor=b;else if(a.tagName!="text"){a.setAttribute("fill",b);a.fillcolor=b}};Libra.Draw2D.SetTitle=function(a,b){if(VML)a.title=b;else a.setAttribute("title",b)};Libra.Draw2D.SetWidthHeight=function(a,c,b){if(VML){a.style.width=c;a.style.height=b}else{a.setAttribute("width",c);a.setAttribute("height",b);if(a.tagName=="ellipse"){a.setAttribute("rx",c/1.8);a.setAttribute("ry",b/1.8);a.setAttribute("cx",c/1.8+a.xx);a.setAttribute("cy",b/1.8+a.yy)}}};var S_vGroup,renderTimeSpan=0;ShowEachYearPoints=function(a,b){$(S_vGroup).children().each(function(){if(this.year&&this.year==a)$(this).show()});if(a<b)setTimeout("ShowEachYearPoints("+(a+1)+","+b+");",renderTimeSpan)}